<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SSD Collection Tracker â€” Public View</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    :root {
      --bg:#0e0f14;
      --panel:#171821;
      --muted:#9aa0b4;
      --accent:#81689D;
      --accent-2:#FFD0EC;
      --radius:12px;
    }

    html,body {
      margin:0;
      background:linear-gradient(180deg,#0b0c10 0%, #0e0f14 100%);
      color:#e6e7ee;
      font-family:"Poppins",sans-serif;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .wrap {
      width:100%;
      max-width:1200px;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    h1 {
      color:var(--accent);
      font-size:20px;
      margin:0;
      text-align:center;
    }

    .muted {
      color:var(--muted);
      font-size:13px;
      text-align:center;
    }

    .panel {
      background:rgba(25,25,32,0.7);
      border:1px solid rgba(255,255,255,0.05);
      border-radius:var(--radius);
      box-shadow:0 0 20px rgba(0,0,0,0.5);
      backdrop-filter:blur(8px);
      overflow:auto;
      max-height:80vh;
      -webkit-overflow-scrolling:touch;
    }

    table {
      width:100%;
      min-width:800px;
      border-collapse:separate;
      border-spacing:0;
    }

    th, td {
      padding:10px 14px;
      border-bottom:1px solid rgba(255,255,255,0.05);
      text-align:left;
      white-space:nowrap;
    }

    thead th {
      position:sticky;
      top:0;
      background:rgba(15,15,20,0.95);
      backdrop-filter:blur(10px);
      z-index:2;
      color:var(--accent);
    }

    td.name {
      font-weight:600;
      color:#fff;
    }

    tr:hover td {
      background:rgba(255,255,255,0.05);
      transition:background 0.15s ease;
    }

    tfoot td {
      font-weight:700;
      border-top:1px solid rgba(255,255,255,0.08);
      color:var(--accent-2);
    }
  </style>
</head>
<body>

<div class="progress-section">
  <h2>Goal: V-Gen Platinum SATA 3 128 GB (Rp176,000)</h2>
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>
  <p id="progressText">Loading...</p>
</div>
  
  <div class="wrap">
    <div>
      <h1>SSD Collection Tracker</h1>
      <div class="muted">Public view</div>
    </div>
    
    <div class="panel">
      <table id="publicTable">
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
        <tfoot id="tableFoot"></tfoot>
      </table>
    </div>
  </div>

  <script>
    const LS_KEY = 'ssd-collection-2025-10';
    let dates = [], students = [], showTotals = false;

    const tableHead = document.getElementById('tableHead');
    const tableBody = document.getElementById('tableBody');
    const tableFoot = document.getElementById('tableFoot');

    function fmtDateShort(d){ return new Date(d).toLocaleDateString(undefined,{day:'2-digit',month:'short'}); }
    function parseNumber(str){
      if(!str) return NaN;
      const s = String(str).replace(/\./g,'').replace(/,/g,'.').trim();
      return Number(s);
    }
    function formatNumber(n){
      if(n===''||n==null||isNaN(n)) return '';
      const int = Math.floor(n);
      const intS = int.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      return intS;
    }

    function computeRowTotal(s){
      let sum=0;
      for(const d of dates){
        const v = s.values[d];
        const n = parseNumber(v);
        if(!isNaN(n)) sum+=n;
      }
      return sum;
    }

    function totalForDate(d){
      let sum=0;
      for(const s of students){
        const v = s.values[d];
        const n = parseNumber(v);
        if(!isNaN(n)) sum+=n;
      }
      return sum;
    }

    function overallTotal(){
      return students.reduce((sum,s)=>sum+computeRowTotal(s),0);
    }

    function loadAndRender(){
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return;
      try {
        const parsed = JSON.parse(raw);
        dates = parsed.dates || [];
        students = parsed.students || [];
        showTotals = parsed.showTotals || false;

        // Sort students alphabetically
        students.sort((a,b)=>a.name.localeCompare(b.name,'en',{sensitivity:'base'}));
      } catch(e){ console.warn('parse error'); }
      render();
    }

    function render(){
      tableHead.innerHTML = '';
      tableBody.innerHTML = '';
      tableFoot.innerHTML = '';

      // Header
      const trh = document.createElement('tr');
      trh.innerHTML = `<th class="name">Name</th>` + 
                      dates.map(d=>`<th>${fmtDateShort(d)}</th>`).join('') +
                      (showTotals ? `<th>Total</th>` : '');
      tableHead.appendChild(trh);

      // Body
      for(const s of students){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="name">${s.name}</td>` +
          dates.map(d=>`<td>${s.values[d] || ''}</td>`).join('') +
          (showTotals ? `<td class="row-total">${formatNumber(computeRowTotal(s))}</td>` : '');
        tableBody.appendChild(tr);
      }

      // Footer
      if(showTotals){
        const trf = document.createElement('tr');
        trf.innerHTML = `<td class="name">Overall Total</td>` +
          dates.map(d=>`<td>${formatNumber(totalForDate(d))}</td>`).join('') +
          `<td>${formatNumber(overallTotal())}</td>`;
        tableFoot.appendChild(trf);
      }
    }

    window.addEventListener('storage', (e)=>{
      if(e.key === LS_KEY) loadAndRender();
    });

    // Initial load
    loadAndRender();

    // Periodic auto-update
    setInterval(loadAndRender, 2000);
  </script>
</body>
</html>
