<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SSD Collection Tracker — Public View</title>
  <link rel="stylesheet" href="style.css">
  <style>
    :root{
      --bg:#0e0f14; --panel:#171821; --muted:#9aa0b4; --accent:#81689D; --accent-2:#FFD0EC; --cell:#121219;
      --radius:12px; --gap:12px; font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body{
      height:100%;
      margin:0;
      background:linear-gradient(180deg,#0b0c10 0%, #0e0f14 100%);
      color:#e6e7ee;
    }
    .wrap{
      max-width:1200px;
      margin:40px auto;
      padding:20px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    header{text-align:center;margin-bottom:10px}
    h1{font-size:22px;color:var(--accent);margin:0}
    .muted{color:var(--muted);font-size:13px}
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      padding:12px;
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 0 12px rgba(0,0,0,0.4);
    }
    .table-wrap{
      overflow:auto;
      border-radius:10px;
      margin-top:12px;
    }
    table{
      border-collapse:separate;
      border-spacing:0;
      width:100%;
      min-width:900px;
    }
    th,td{
      padding:8px 10px;
      text-align:left;
      border-bottom:1px solid rgba(255,255,255,0.03);
    }
    thead th{
      position:sticky;
      top:0;
      background:linear-gradient(180deg, rgba(20,20,28,0.9), rgba(18,18,22,0.9));
      backdrop-filter: blur(4px);
      z-index:2;
      color:var(--accent);
    }
    th.name{width:200px}
    td.name{font-weight:600;color:var(--accent)}
    .row-total{font-weight:700;color:var(--accent-2)}
    tfoot td{font-weight:700;border-top:1px solid rgba(255,255,255,0.04)}
    footer{text-align:center;margin-top:20px;color:var(--muted);font-size:13px}
    @media(max-width:820px){.wrap{padding:10px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>SSD Collection Tracker</h1>
      <div class="muted">Public View — Auto Dates (8 Oct → 31 Oct)</div>
    </header>

    <div class="table-wrap panel" id="tablePanel">
      <table id="dataTable">
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
        <tfoot id="tableFoot"></tfoot>
      </table>
    </div>

    <footer>
      <div>Read-only data view — synced from your local browser storage.</div>
    </footer>
  </div>

<script>
const LS_KEY = 'ssd-collection-2025-10';
const startDate = new Date('2025-10-08');
const endDate = new Date('2025-10-31');

let dates = [];
let students = [];
let showTotals = true; // always true for public

const tableHead = document.getElementById('tableHead');
const tableBody = document.getElementById('tableBody');
const tableFoot = document.getElementById('tableFoot');

function isWeekday(d){const day=d.getDay();return day!==0&&day!==6}
function fmtDateShort(d){return d.toLocaleDateString(undefined,{day:'2-digit',month:'short'});}
function iso(d){return d.toISOString().slice(0,10);}
function generateDates(){
  const arr=[];
  let d=new Date(startDate);
  while(d<=endDate){if(isWeekday(d))arr.push(new Date(d));d.setDate(d.getDate()+1);}
  return arr.map(x=>iso(x));
}
function parseNumber(str){
  if(str==null)return NaN;
  const s=String(str).replace(/\./g,'').replace(/,/g,'.').trim();
  return Number(s);
}
function formatNumber(n){
  if(n===''||n==null||isNaN(n))return '';
  const int=Math.floor(n);
  const frac=(n-int)?(n-int).toFixed(3).replace(/0+$/,'').replace(/\.$/,''):'';
  const intS=int.toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.');
  return frac?intS+','+frac.slice(2):intS;
}
function computeRowTotal(s){
  let sum=0;for(const d of dates){const v=s.values[d];if(!v)continue;const num=parseNumber(v);if(!isNaN(num))sum+=num;}
  return sum;
}
function totalForDate(d){
  let sum=0;for(const s of students){const v=s.values[d];const n=parseNumber(v);if(!isNaN(n))sum+=n;}
  return sum;
}
function overallTotal(){
  let sum=0;for(const s of students)sum+=computeRowTotal(s);
  return sum;
}

function load(){
  const raw=localStorage.getItem(LS_KEY);
  dates=generateDates();
  if(raw){
    try{
      const parsed=JSON.parse(raw);
      if(parsed.dates)dates=parsed.dates;
      if(parsed.students)students=parsed.students;
    }catch(e){console.warn('parse failed')}
  }
  render();
}

function render(){
  tableHead.innerHTML='';
  const tr=document.createElement('tr');
  tr.innerHTML=`<th class="name">Name</th>`+dates.map(d=>`<th>${fmtDateShort(new Date(d))}</th>`).join('')+`<th>Row Total</th>`;
  tableHead.appendChild(tr);

  tableBody.innerHTML='';
  for(const s of students){
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="name">${s.name}</td>`+
      dates.map(d=>`<td>${s.values[d]||''}</td>`).join('')+
      `<td class="row-total">${formatNumber(computeRowTotal(s))}</td>`;
    tableBody.appendChild(tr);
  }

  tableFoot.innerHTML='';
  const trf=document.createElement('tr');
  trf.innerHTML=`<td class="name">Overall Total</td>`+
    dates.map(d=>`<td>${formatNumber(totalForDate(d))}</td>`).join('')+
    `<td class="row-total">${formatNumber(overallTotal())}</td>`;
  tableFoot.appendChild(trf);
}

load();
</script>
</body>
</html>
